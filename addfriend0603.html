<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>Redirecting...</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Open Graph é è¦½ -->
  <meta property="og:title" content="åŠ å…¥å¥½å‹">
  <meta property="og:description" content="è«‹ç™»å…¥å¾Œè‡ªå‹•åŠ å…¥å¥½å‹">
  <meta property="og:url" content="https://lineliff.jowua-life.com/addfriend0603.html"> <!-- ç¢ºä¿é€™è£¡æ›´æ–°ç‚ºä½ çš„æ–°ç¶²åŸŸ -->
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://lineliff.jowua-life.com/ä½ çš„é è¦½åœ–.jpg"> <!-- è«‹æ›¿æ›ç‚ºä½ çš„å¯¦éš›é è¦½åœ–ç¶²å€ -->

  <!-- Meta Pixel æˆ– GA4 æˆ– LINE Tag ç¨‹å¼ç¢¼ å°‡è²¼åœ¨é€™è£¡ (å¦‚æœæœ‰çš„è©±) -->

<style>
    html, body {
      margin: 0;
      padding: 0;
      height: 300vh;
      background-color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      box-sizing: border-box;
    }
    .logo-container {
      position: relative;
      width: 280px;
      height: auto;
    }
    .gray-logo, .black-logo {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: auto;
      display: block;
    }
    .black-logo {
      clip-path: inset(0 100% 0 0);
      animation: revealLogo 1s ease-out forwards;
    }
    @keyframes revealLogo {
      0% { clip-path: inset(0 100% 0 0); }
      100% { clip-path: inset(0 0% 0 0); }
    }
  </style>
  <!-- å¼•å…¥ QR Code ç”¢ç”Ÿå‡½å¼åº« -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
</head>
<body>
  <div class="logo-container">
    <img class="gray-logo" src="../images/jowuagray.png" alt="JOWUA Gray">
    <img class="black-logo" src="../images/jowuablack.png" alt="JOWUA Black">
  </div>

  <script>
    const liffId = "2003553378-R3m1nVmp"; // ä½ çš„ LIFF ID
    const externalRedirectUrl = "https://line.me/R/ti/p/@653dssrk"; // LINEå®˜æ–¹å¸³è™Ÿ
    async function main() {
      try {
        await liff.init({ liffId });
        await liff.ready;
        if (!liff.isLoggedIn()) {
          liff.login();
          return;
        }
        const profile = await liff.getProfile();
        const uid = profile.userId;
        const nickname = profile.displayName;
        const email = liff.getDecodedIDToken()?.email || "";
        const phone = liff.getDecodedIDToken()?.phone_number || "";
        await fetch("https://hook.us1.make.com/qg5bzhbwyjknwcdsydnhc98amqqhm56n", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ uid, nickname, email, phone })
        });
        // å¼·åˆ¶å•Ÿå‹• LINE app
        if (liff.isInClient()) {
          // å¦‚æœåœ¨ LINE å…§å»ºç€è¦½å™¨ä¸­ï¼Œä½¿ç”¨ liff.openWindow
          liff.openWindow({
            url: externalRedirectUrl,
            external: true
          });
        } else {
          // å¦‚æœåœ¨å¤–éƒ¨ç€è¦½å™¨ä¸­ï¼Œå˜—è©¦å¤šç¨®æ–¹å¼å•Ÿå‹• LINE app
          try {
            // æ–¹æ³•1: ç›´æ¥é‡æ–°å°å‘
            window.location.href = externalRedirectUrl;
            
            // æ–¹æ³•2: å¦‚æœä¸Šé¢æ²’æœ‰ç«‹å³è·³è½‰ï¼Œå»¶é²å¾Œå†è©¦
            setTimeout(() => {
              window.open(externalRedirectUrl, '_blank');
            }, 1000);
          } catch (e) {
            console.log('ç„¡æ³•è‡ªå‹•å•Ÿå‹• LINE app');
            // å‚™ç”¨æ–¹æ¡ˆï¼šé¡¯ç¤ºé€£çµè®“ä½¿ç”¨è€…æ‰‹å‹•é»æ“Š
            document.body.innerHTML = `
              <div style="text-align: center; padding: 20px;">
                <p>è«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•</p>
                <a href="${externalRedirectUrl}" style="display: inline-block; padding: 10px 20px; background: #00C300; color: white; text-decoration: none; border-radius: 5px;">é–‹å•Ÿ LINE</a>
              </div>
            `;
          }
        }
      } catch (err) {
        console.error("éŒ¯èª¤ï¼š", err);
        document.querySelector('.loading').innerHTML = `<p>ğŸš¨ ç™¼ç”ŸéŒ¯èª¤ï¼š${err.message}</p>`;
      }
    }
    main();
  </script>
</body>
</html>
